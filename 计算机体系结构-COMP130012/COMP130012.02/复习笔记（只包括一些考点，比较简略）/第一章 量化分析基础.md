# 第一章 量化分析基础

## 分类

计算机硬件以四种主要方式开发并行：

- 指令级并行
- 向量体系结构和GPU
- 线程级并行
- 请求级并行

计算机的系统结构分为四类：

- 单指令流单数据流(SISD)
- 单指令流多数据流(SIMD)
- 多指令流单数据流(MISD)
- 多指令流多数据流(MIMD)

指令集体系结构（ISA）：程序员看到的实际指令集：

- 寄存器-存储器 ISA
- 载入-存储 ISA

## 可信任度

**可信任度**的两种度量：

**平均无故障时间** (MTTF) MTTF的倒数就是系统的**失效率**

失效率（FIT）以10亿小时发生的故障数表示

MTTF=1 000 000小时，相当于
$$
\frac{1}{1000000}*10亿(10^9)=1000FIT
$$
**服务中断以平均修复时间** (MTTR) 来度量

**平均故障间隔时间** (MTBF) 就是 MTTF+MTTR

**模块可用性**：系统正常工作的时间在连续两次正常服务间隔时间中所占的比率。
$$
模块可用性 = \frac{MTTF}{MTTF+MTTR}
$$

---

习题：由部件计算整个系统的平均无故障时间MTTF

部件MTTF → 部件故障率 → 系统故障率 → 系统MTTF

![image-20220531225610718](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E9%87%8F%E5%8C%96%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80.assets/image-20220531225610718.png)

---

## 性能测量

x的性能是y的N倍 → y的执行时间是x的N倍

Amdahl定律：计算通过改进计算机某一部分而能获得的性能增益

Amdahl定律阐述了一种性能改进的递减规则：如果仅仅对计算任务中的一部分做性能改进，则改进得越多，得到的总体性能的提升就越有限。

如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过 $\frac{1}{1-可改进比例}$

重要的概念是**加速比**（一般大于1）：
$$
加速比=\frac{系统性能_{改进后}}{系统性能_{改进前}}
$$
加速比依赖于**可改进比例**（总是小于1）
$$
可改进比例 = 在改进前的系统中 可改进部分的执行时间 在总的执行时间中所占的比例
$$
一个需运行60秒的程序中有20秒的运算可以加速，那么这个比例就是20/60。

加速比依赖于**部件加速比**（一般大于1）：
$$
部件加速比=可改进部分改进以后性能提高的倍数
$$
若系统改进后，可改进部分的执行时间是2秒，而改进前其执行时间为5秒，则部件加速比为5/2。
$$
总执行时间_{改进后}＝不可改进部分的执行时间 + 可改进部分改进后的执行时间 \\
= (1－可改进比例)×总执行时间_{改进前} + \frac{可改进比例*总执行时间_{改进前}}{部件加速比}\\
= 总执行时间_{改进前} \times [(1-可改进比例)+\frac{可改进比例}{部件加速比}]
$$

$$
总加速比 = \frac{原执行时间}{新执行时间}=\frac{1}{(1-可改进比例)+\frac{可改进比例}{部件加速比}}
$$
多个部件课改进情况下，可以对定理进行扩展：

![image-20220531234911292](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E9%87%8F%E5%8C%96%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80.assets/image-20220531234911292.png)

---

习题：提升某个功能，算整个系统性能提升

![image-20220531231912686](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E9%87%8F%E5%8C%96%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80.assets/image-20220531231912686.png)

---

## 处理器性能

执行一个程序的CPU时间：执行程序所需的**时钟周期数**×**时钟周期时间**

时钟周期时间是系统**时钟频率**的倒数  例：一个时钟周期20ns-> 50MHz (1/50*10^6)

每条指令执行的平均时钟周期数**CPI**（Cycles Per Instruction）
$$
CPI = 执行程序所需的时钟周期数／IC
$$
IC：所执行的指令条数
$$
CPU时间 = IC ×CPI ×时钟周期时间
$$
CPU性能三个参数：

- 时钟周期时间：取决于硬件实现技术和计算机组成
- CPI：取决于指令集结构
- IC：取决于指令集结构和编译技术

MIPS：每秒处理百万条指令数

---

习题：

CPUA：通过比较指令设置条件码，然后测试条件码进行分支

CPUB：在分支指令中包括比较过程

在这两种CPU中，条件分支指令都占用2个时钟周期，而所有其他指令占用1个时钟周期。对于CPUA，执行的指令中分支指令占20%；由于每条分支指令之前都需要有比较指令，因此比较指令也占20%。

由于CPUA在分支时不需要比较，因此CPUB的时钟周期时间是CPUA的1.25倍。

问：哪一个CPU更快？如果CPUB的时钟周期时间只是CPUA的1.1倍，哪一个CPU更快呢？

先算各自的CPI，A是 $0.2 * 2 + 0.8 * 1 = 1.2$ 

B是没有比较指令，所以总数是A的0.8倍，那分支占A的0.2，就是他自己的 0.2/0/8=0.25， 故 $0.25 * 2 + 0.75 * 1 = 1.25$ 
$$
性能(CPU时间)=CPI*IC*时钟周期\\\\
CPU时间_A=IC_A × 1.2 ×时钟周期_A \\\\
CPU时间_B=IC_B × 1.25 × 时钟周期_B\\
= 0.8 × IC_A × 1.25 × (1.25×时钟周期_A)\\
= 1.25 ×IC_A ×时钟周期_A
$$

---



